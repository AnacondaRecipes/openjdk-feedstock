# Based on recipes from birdhouse and anaconda channel.

{% set name = "openjdk" %}
{% set version = "11.0.2" %}
{% set version_ = '_'.join(version.split('.')) %}
{% set intellij_build = "164" %}
{% set build_number = 0 %}
{% set sha256_osx = "5de2b44d0222ee22831ba6aff8f6e02a192b21f2720af60189b7e30085eeacfc" %}
{% set sha256_jbrex_osx = "ad7e426a27e17e949d73b73c6c77bb4868f73d76894d79455e7fdb998a9bc6d3" %}
{% set sha256_linux_64 = "52ba257d6010b83d5083d61ad5355449a2ea20b2bf7aba211218a54f42c00c43" %}
{% set sha256_jbrex_linux_64 = "b1fd13455d3aa4005f9ff41f5ff222a6a8043eb492239d26c0f47437f7fb3e88" %}
{% set sha256_dejagnu_fonts = "f12d7e7f7adedcda09cc3d2281645ac72504aaa0949690233418867adb50fa6e" %}
{% set sha256_win_64 = "493b43ad606d0d3629fc3c6c30ba55148ede56182a9951f0b9cb33f13593366e" %}
{% set sha256_jbrex_win_64 = "50858ad8bebe03d166ca993ccd2373e47f1c4ec3a6689e402df37befa0b48c32" %}

{% if target_platform == 'osx-64' %}
{% set jbpf = 'osx-x64' %}
{% elif target_platform == 'linux-64' %}
{% set jbpf = 'linux-x64' %}
{% elif target_platform == 'win-64' %}
{% set jbpf = 'windows-x64' %}
{% endif %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://bintray.com/jetbrains/intellij-jdk/download_file?file_path=jbr-{{ version_ }}-{{ jbpf }}-b{{ intellij_build }}.tar.gz
    fn: jbr-{{ version_ }}-{{ jbpf }}-b{{ intellij_build }}.tar.gz
    sha256: {{ sha256_osx }}  # [osx]
    sha256: {{ sha256_linux_64 }}  # [linux64]
    sha256: {{ sha256_win_64 }}  # [win64]
    folder: jdk
  - url: https://bintray.com/jetbrains/intellij-jdk/download_file?file_path=jbrsdk-{{ version_ }}-{{ jbpf }}-b{{ intellij_build }}.tar.gz
    fn: jbrsdk-{{ version_ }}-{{ jbpf }}-b{{ intellij_build }}.tar.gz
    folder: jbrex/jre
    sha256: {{ sha256_jbrex_osx }}  # [osx]
    sha256: {{ sha256_jbrex_linux_64 }}  # [linux64]
    sha256: {{ sha256_jbrex_win_64 }}  # [win64]
  # Depend upon anaconda-fonts instead here and have jre/lib/fonts be a symlink to them?
  - url: http://sourceforge.net/projects/dejavu/files/dejavu/2.36/dejavu-fonts-ttf-2.36.tar.bz2  # [linux]
    sha256: {{ sha256_dejagnu_fonts }}  # [linux]
    folder: jre/lib/fonts  # [linux]

build:
  number: {{ build_number }}
  track_features:
    - openjdk
  rpath:
    - lib
    - jre/lib

test:
  requires:
    - {{ compiler('c') }}
  files:
    - test-jni  # [not win]
    - test-jni.sh  # [not win]
    - test-nio
  commands:
    - java -version
    - ./test-jni.sh  # [not win]
    - conda inspect linkages -p ${PREFIX} openjdk  # [linux]
    - conda inspect objects -p ${PREFIX} openjdk  # [osx]

about:
  home: https://bintray.com/jetbrains/intellij-jdk
  license: GPLv2
  license_family: GPL
  summary: The JetBrains Runtime OpenJDK build.
  description: |
    JetBrains Runtime is a runtime environment for running
    IntelliJ Platform based products on Windows, Mac OS X, and Linux
  dev_url: https://github.com/JetBrains/jdk8u

extra:
  recipe-maintainers:
    - johanneskoester
    - mingwandroid
    - sodre
